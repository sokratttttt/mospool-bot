{% extends 'base.html' %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - üèä –ë–∞—Å—Å–µ–π–Ω—ã{% endblock %}
{% block page_title %}‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏{% endblock %}

{% block content %}
<div class="settings-grid">
    <!-- Platforms -->
    <div class="card">
        <div class="card-header">
            <h3>üîå –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã</h3>
        </div>
        <div class="card-body">
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ <a href="/admin/posts/platform/">Django Admin</a></p>

            {% for platform in platforms %}
            <div class="platform-card">
                <div class="platform-info">
                    <span class="platform-icon">
                        {% if platform.name == 'telegram' %}üì±{% else %}üí¨{% endif %}
                    </span>
                    <div class="platform-details">
                        <span class="platform-name">{{ platform.display_name }}</span>
                        <span class="platform-channel">{{ platform.channel_id }}</span>
                    </div>
                    <span class="status-badge {% if platform.is_active %}active{% else %}inactive{% endif %}">
                        {% if platform.is_active %}‚úÖ –ê–∫—Ç–∏–≤–Ω–∞{% else %}‚ùå –û—Ç–∫–ª—é—á–µ–Ω–∞{% endif %}
                    </span>
                </div>
                <div class="platform-actions">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="test_{{ platform.name }}">
                        <button type="submit" class="btn btn-sm btn-secondary">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </form>
                </div>
            </div>
            {% empty %}
            <p class="empty-text">–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</p>
            <a href="/admin/posts/platform/add/" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</a>
            {% endfor %}
        </div>
    </div>

    <!-- AI Settings -->
    <div class="card">
        <div class="card-header">
            <h3>ü§ñ Mistral AI</h3>
        </div>
        <div class="card-body">
            <p>Mistral AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.</p>
            <p><a href="https://console.mistral.ai/" target="_blank">–ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á ‚Üí</a></p>

            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="test_mistral">
                <button type="submit" class="btn btn-secondary">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </form>
        </div>
    </div>

    <!-- Scheduler Status -->
    <div class="card">
        <div class="card-header">
            <h3>‚è∞ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫</h3>
        </div>
        <div class="card-body">
            <div class="scheduler-status">
                <span class="status-badge {% if scheduler_status.running %}active{% else %}inactive{% endif %}">
                    {% if scheduler_status.running %}‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç{% else %}‚ùå –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω{% endif %}
                </span>
                <span>–ó–∞–¥–∞—á: {{ scheduler_status.job_count }}</span>
            </div>

            {% if scheduler_status.jobs %}
            <table class="data-table">
                <thead>
                    <tr>
                        <th>–ó–∞–¥–∞—á–∞</th>
                        <th>–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫</th>
                    </tr>
                </thead>
                <tbody>
                    {% for job in scheduler_status.jobs %}
                    <tr>
                        <td>{{ job.name }}</td>
                        <td>{{ job.next_run_time|default:"‚Äî" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>
    </div>

    <!-- Schedule Slots -->
    <div class="card">
        <div class="card-header">
            <h3>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h3>
        </div>
        <div class="card-body">
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª–æ—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–π:</p>

            {% if schedule_slots %}
            <table class="data-table">
                <thead>
                    <tr>
                        <th>–î–µ–Ω—å</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for slot in schedule_slots %}
                    <tr>
                        <td>{{ slot.get_day_of_week_display }}</td>
                        <td>{{ slot.time|time:"H:i" }}</td>
                        <td>
                            {% for p in slot.platforms.all %}
                            {{ p.display_name }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                        <td>{% if slot.is_active %}‚úÖ{% else %}‚ùå{% endif %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="empty-text">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</p>
            {% endif %}

            <a href="/admin/posts/scheduleslot/" class="btn btn-secondary">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="card">
        <div class="card-header">
            <h3>üîó –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h3>
        </div>
        <div class="card-body">
            <ul class="quick-links">
                <li><a href="/admin/">üîß Django Admin</a></li>
                <li><a href="/admin/posts/platform/">üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏</a></li>
                <li><a href="/admin/posts/posttemplate/">üìù –®–∞–±–ª–æ–Ω—ã –ø–æ—Å—Ç–æ–≤</a></li>
                <li><a href="/admin/posts/postcategory/">üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
                <li><a href="https://t.me/BotFather" target="_blank">ü§ñ –°–æ–∑–¥–∞—Ç—å Telegram –±–æ—Ç–∞</a></li>
                <li><a href="https://vk.com/apps?act=manage" target="_blank">üí¨ VK –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è</a></li>
                <li><a href="https://console.mistral.ai/" target="_blank">üß† Mistral AI Console</a></li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}