{% extends 'base.html' %}

{% block title %}{{ post.title }} - üèä –ë–∞—Å—Å–µ–π–Ω—ã{% endblock %}
{% block page_title %}üìù {{ post.title }}{% endblock %}

{% block header_actions %}
<div class="btn-group">
    {% if post.status == 'pending' %}
    <form method="post" action="{% url 'post_approve' post.id %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
    </form>
    {% endif %}

    {% if post.status in 'approved,scheduled' %}
    <form method="post" action="{% url 'post_publish' post.id %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å</button>
    </form>
    {% endif %}

    <a href="{% url 'post_edit' post.id %}" class="btn btn-secondary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

    <form method="post" action="{% url 'post_delete' post.id %}" style="display: inline;"
        onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?');">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
    </form>
</div>
{% endblock %}

{% block content %}
<div class="detail-grid">
    <!-- Main Content -->
    <div class="detail-main">
        <div class="card">
            <div class="card-header">
                <span class="badge badge-{{ post.status }} badge-lg">{{ post.get_status_display }}</span>
                {% if post.category %}
                <span class="badge badge-category">{{ post.category.name }}</span>
                {% endif %}
                {% if post.ai_generated %}
                <span class="badge badge-ai">ü§ñ –ò–ò</span>
                {% endif %}
            </div>
            <div class="card-body">
                {% if post.image %}
                <div class="post-image">
                    <img src="{{ post.image.url }}" alt="{{ post.title }}">
                </div>
                {% endif %}

                <div class="post-content">
                    <h3>–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç</h3>
                    <pre class="content-preview">{{ post.content }}</pre>
                </div>

                {% if post.content_telegram %}
                <div class="post-content">
                    <h3>üì± Telegram –≤–µ—Ä—Å–∏—è</h3>
                    <pre class="content-preview">{{ post.content_telegram }}</pre>
                </div>
                {% endif %}

                {% if post.content_vk %}
                <div class="post-content">
                    <h3>üí¨ VK –≤–µ—Ä—Å–∏—è</h3>
                    <pre class="content-preview">{{ post.content_vk }}</pre>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Publications Log -->
        <div class="card">
            <div class="card-header">
                <h3>üì§ –ò—Å—Ç–æ—Ä–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h3>
            </div>
            <div class="card-body">
                {% if publications %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>ID</th>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–°—Å—ã–ª–∫–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pub in publications %}
                        <tr>
                            <td>
                                <span class="badge badge-platform-{{ pub.platform.name }}">
                                    {{ pub.platform.display_name }}
                                </span>
                            </td>
                            <td>
                                <span class="badge badge-{{ pub.status }}">{{ pub.get_status_display }}</span>
                            </td>
                            <td><code>{{ pub.external_id }}</code></td>
                            <td>{{ pub.published_at|date:"d.m.Y H:i" }}</td>
                            <td>
                                {% if pub.external_url %}
                                <a href="{{ pub.external_url }}" target="_blank" class="btn btn-sm">üîó –û—Ç–∫—Ä—ã—Ç—å</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% if pub.error_message %}
                        <tr class="error-row">
                            <td colspan="5">
                                <div class="error-message">‚ùå {{ pub.error_message }}</div>
                            </td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="empty-text">–ï—â—ë –Ω–µ –ø—É–±–ª–∏–∫–æ–≤–∞–ª—Å—è</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="detail-sidebar">
        <div class="card">
            <div class="card-header">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            </div>
            <div class="card-body">
                <dl class="info-list">
                    <dt>–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã</dt>
                    <dd>
                        {% for platform in post.platforms.all %}
                        <span class="badge badge-platform-{{ platform.name }}">
                            {% if platform.name == 'telegram' %}üì±{% else %}üí¨{% endif %}
                            {{ platform.display_name }}
                        </span>
                        {% empty %}
                        <span class="text-muted">–ù–µ –≤—ã–±—Ä–∞–Ω—ã</span>
                        {% endfor %}
                    </dd>

                    <dt>–í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</dt>
                    <dd>
                        {% if post.scheduled_time %}
                        üìÖ {{ post.scheduled_time|date:"d.m.Y H:i" }}
                        {% else %}
                        <span class="text-muted">–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</span>
                        {% endif %}
                    </dd>

                    <dt>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω</dt>
                    <dd>
                        {% if post.published_at %}
                        ‚úÖ {{ post.published_at|date:"d.m.Y H:i" }}
                        {% else %}
                        <span class="text-muted">–ù–µ—Ç</span>
                        {% endif %}
                    </dd>

                    <dt>–°–æ–∑–¥–∞–Ω</dt>
                    <dd>{{ post.created_at|date:"d.m.Y H:i" }}</dd>

                    <dt>–û–±–Ω–æ–≤–ª—ë–Ω</dt>
                    <dd>{{ post.updated_at|date:"d.m.Y H:i" }}</dd>

                    {% if post.created_by %}
                    <dt>–ê–≤—Ç–æ—Ä</dt>
                    <dd>{{ post.created_by.username }}</dd>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>
</div>
{% endblock %}